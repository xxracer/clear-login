
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Funciones de Ayuda ---
    function isSignedIn() {
      return request.auth != null;
    }

    // --- Reglas para Colecciones Principales ---

    // La colección 'companies' puede ser leída y escrita por cualquier administrador autenticado.
    match /companies/{companyId} {
      allow read, write: if isSignedIn();
    }

    // La colección 'candidates' y todos sus documentos y subcolecciones anidadas
    // pueden ser leídos y escritos por cualquier administrador autenticado.
    // Esto es crucial para el funcionamiento del dashboard.
    match /candidates/{candidateId}/{documents=**} {
      allow read, write: if isSignedIn();
    }
    
    // Regla de respaldo para datos específicos del usuario, si se añade en el futuro.
    // Permite a un usuario modificar solo su propio documento en la colección 'users'.
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
